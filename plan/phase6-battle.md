# フェーズ6: 戦闘システム

## 目的
タップ攻撃・敵自動攻撃・勝敗判定の戦闘ループを実装する。

## 依存
- フェーズ2（プレイヤー）
- フェーズ3（ダメージ計算）
- フェーズ4（敵生成）

## 実装ファイル
- `src/lib/battle.ts`

## 関数

### createBattleState
戦闘開始時の状態を生成する。
- プレイヤーと敵の情報を保持

### playerAttack
プレイヤーが攻撃する（タップ時）。
- ダメージ計算（属性相性込み）
- 敵HPを減少

### enemyAttack
敵の自動攻撃。
- 一定間隔で発動
- プレイヤーHPを減少

### checkBattleResult
戦闘結果を判定する。
- 敵HP≤0 → 勝利（EXP・Gold・武器ドロップ処理）
- プレイヤーHP≤0 → 死亡

### processBattleRewards
勝利時の報酬を処理する。
- EXP加算（異常個体なら×100）
- Gold加算
- 武器ドロップ判定・装備更新

## テスト
- プレイヤー攻撃で敵HPが正しく減少すること
- 属性有利で2倍ダメージになること
- 敵攻撃でプレイヤーHPが減少すること
- 敵HP0以下で勝利判定になること
- プレイヤーHP0以下で死亡判定になること
- 異常個体撃破でEXP100倍が適用されること
- 武器ドロップで装備が更新されること

## 完了条件
- 全テストが通る
