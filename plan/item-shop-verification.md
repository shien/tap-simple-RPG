# アイテム＆ショップシステム 動作確認方法

## 1. 自動テスト

```bash
npm test
```

全268テストが通ること。以下のテストファイルが関連:

| テストファイル | 確認内容 |
|---|---|
| `src/lib/item.test.ts` | アイテム生成・ショップ商品生成・アイテム消費・所持判定 |
| `src/lib/event.test.ts` | ショップイベントの出現確率 |
| `src/lib/battle.test.ts` | 武器の塗料・古びた鋼鉄の盾・回復の薬の使用、属性復元 |
| `src/lib/game.test.ts` | ショップ購入・ショップ退出・アイテム初期化 |
| `src/lib/player.test.ts` | プレイヤー初期状態にitems:[]があること |
| `src/lib/constants.test.ts` | 確率テーブル合計が1になること（shop含む） |

## 2. ビルド確認

```bash
npm run build
```

TypeScriptエラーなくビルドが通ること。

## 3. ブラウザ動作確認

```bash
npm run dev
```

### 3-1. ショップイベントの出現

1. ゲームを開始して「進む」ボタンを繰り返しタップ
2. イベントプレビューに紫色の「ショップ」が表示されることがある
3. ショップマスに止まるとショップ画面が表示される

**確認ポイント:**
- ショップ画面に3つのアイテム（武器の塗料・古びた鋼鉄の盾・回復の薬）が表示される
- 各アイテムに価格が表示される
- 所持ゴールドが表示される

### 3-2. ショップでの購入

1. ゴールドが十分ある状態でショップに入る
2. 「購入」ボタンをタップ

**確認ポイント:**
- ゴールドが減少する
- ゴールド不足のアイテムは「ゴールド不足」とグレー表示になる
- 同じアイテムを複数回購入できる
- 「立ち去る」ボタンで探索に戻る

### 3-3. 探索画面のアイテム表示

1. アイテムを購入してから探索画面に戻る

**確認ポイント:**
- 探索画面に「アイテム: N個」と紫色で表示される

### 3-4. 戦闘中のアイテム使用 — 武器の塗料

1. 武器の塗料を所持した状態で戦闘に入る
2. 「武器の塗料」ボタンをタップ
3. 属性選択UI（水/土/雷）が表示される
4. 敵に有利な属性を選択

**確認ポイント:**
- 相性表示が変更後の属性に基づいて更新される
- ダメージ倍率が変更される
- アイテム個数が1減る
- 戦闘勝利後、武器属性が元に戻る（結果画面で確認）

### 3-5. 戦闘中のアイテム使用 — 古びた鋼鉄の盾

1. 古びた鋼鉄の盾を所持した状態で戦闘に入る
2. 「古びた鋼鉄の盾」ボタンをタップ

**確認ポイント:**
- 「完全防御発動中」インジケーターが表示される
- 次の敵攻撃でダメージが0になる
- 完全防御後、ガードカウンターが発動する（攻撃ボタンが黄色「カウンター!」に）
- アイテム個数が1減る

### 3-6. 戦闘中のアイテム使用 — 回復の薬

1. HPが減った状態で回復の薬を使用

**確認ポイント:**
- HPがMaxHPの40%分回復する
- MaxHPを超えない
- アイテム個数が1減る

### 3-7. 死亡時のアイテムリセット

1. アイテムを所持した状態でHP0になる
2. 最初からやり直す

**確認ポイント:**
- アイテムがすべてリセットされる（探索画面にアイテム表示がない）

### 3-8. アイテム0個時の非表示

1. アイテムを持っていない状態で戦闘に入る

**確認ポイント:**
- アイテムスロットが表示されない

## 4. エッジケース確認

- ショップで所持ゴールドちょうどの購入ができる
- 武器の塗料を2回使用しても、戦闘後は最初の元属性に戻る
- 完全防御中にガードボタンも押した場合、完全防御が優先される
- 属性変更のキャンセルが正しく動作する（キャンセルボタン）
